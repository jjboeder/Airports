<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>European Airports Map</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2980b9">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Airports">
  <link rel="apple-touch-icon" href="icons/icon-180.png">

  <!-- Leaflet 1.9.4 -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="map"></div>

  <!-- Weather time control bar -->
  <div id="wx-time-bar" class="wx-time-bar" style="display:none;">
    <button id="wx-time-back" class="wx-time-btn" title="Back 3 hours">&laquo;</button>
    <button id="wx-time-back1" class="wx-time-btn" title="Back 15 min">&lsaquo;</button>
    <span id="wx-time-label" class="wx-time-label">Now</span>
    <button id="wx-time-fwd1" class="wx-time-btn" title="Forward 15 min">&rsaquo;</button>
    <button id="wx-time-fwd" class="wx-time-btn" title="Forward 3 hours">&raquo;</button>
    <button id="wx-time-now" class="wx-time-btn wx-time-now" title="Reset to now">Now</button>
  </div>

  <!-- LLF time step bar -->
  <div id="llf-time-bar" class="llf-time-bar" style="display:none;">
    <span class="llf-time-label">LLF</span>
  </div>

  <!-- Route Weather floating panel -->
  <div id="route-wx-panel" class="route-wx-panel" style="display:none;">
    <div class="route-wx-panel-hdr">
      <button class="route-wx-panel-tab active" data-rwtab="rw-airgram">Airgram</button>
      <button class="route-wx-panel-tab" data-rwtab="rw-gramet">GRAMET</button>
      <button class="route-wx-panel-tab" data-rwtab="rw-flcomp">FL Compare</button>
      <button class="route-wx-panel-tab" data-rwtab="rw-briefing">Briefing</button>
      <span style="flex:1"></span>
      <button class="route-wx-panel-close">&times;</button>
    </div>
    <div class="route-wx-panel-body">
      <div id="rw-airgram" class="route-wx-panel-content"></div>
      <div id="rw-gramet" class="route-wx-panel-content" style="display:none;"></div>
      <div id="rw-flcomp" class="route-wx-panel-content" style="display:none;"></div>
      <div id="rw-briefing" class="route-wx-panel-content" style="display:none;"></div>
    </div>
  </div>

  <!-- SWC floating panel -->
  <div id="swc-panel" class="swc-panel" style="display:none;">
    <div class="swc-panel-hdr">
      <span class="swc-panel-title">SWC</span>
      <div class="swc-region-tabs">
        <button class="swc-region-btn swc-region-active" data-region="finland">Finland</button>
        <button class="swc-region-btn" data-region="nordic">Nordic</button>
        <button class="swc-region-btn" data-region="europe">Europe</button>
      </div>
      <span class="swc-panel-time"></span>
      <a class="swc-panel-pdf" target="_blank" rel="noopener" style="display:none">PDF</a>
      <button class="swc-panel-close">&times;</button>
    </div>
    <div class="swc-panel-body">
      <span class="metar-loading">Loading SWC...</span>
    </div>
  </div>

  <div id="airport-search" class="panel">
    <input type="text" id="search-input" placeholder="Search ICAO, IATA, name..." autocomplete="off">
    <div id="search-results"></div>
  </div>

  <div id="legend-min" class="panel-mini panel-mini-left visible" title="Legend">&#9432;</div>
  <div id="legend" class="panel minimized">
    <button class="panel-minimize" data-target="legend" data-mini="legend-min" title="Minimize">&minus;</button>
    <h3>Airport Types</h3>
    <div class="legend-item">
      <span class="legend-dot" style="background:#e74c3c; width:12px; height:12px;"></span>
      Large airport
    </div>
    <div class="legend-item">
      <span class="legend-dot" style="background:#3498db; width:9px; height:9px;"></span>
      Medium airport
    </div>
    <div class="legend-item">
      <span class="legend-dot" style="background:#27ae60; width:6px; height:6px;"></span>
      Small airport
    </div>
    <div class="legend-item">
      <input type="checkbox" id="rwy-filter-toggle" checked>
      <label for="rwy-filter-toggle" style="font-size:11px;color:#444;cursor:pointer;margin:0;">Hide short/unpaved runways</label>
    </div>
    <h3 class="legend-section">METAR</h3>
    <div class="legend-item">
      <span style="color:#27ae60;font-weight:700;font-family:monospace;font-size:11px;width:38px;display:inline-block;">VFR</span>
      &gt;3000 ft / &gt;8 km
    </div>
    <div class="legend-item">
      <span style="color:#3498db;font-weight:700;font-family:monospace;font-size:11px;width:38px;display:inline-block;">MVFR</span>
      1000–3000 ft / 5–8 km
    </div>
    <div class="legend-item">
      <span style="color:#e67e22;font-weight:700;font-family:monospace;font-size:11px;width:38px;display:inline-block;">BIR</span>
      600–999 ft / 1.5–5 km
    </div>
    <div class="legend-item">
      <span style="color:#e74c3c;font-weight:700;font-family:monospace;font-size:11px;width:38px;display:inline-block;">IFR</span>
      500–599 ft / &ge;1.5 km
    </div>
    <div class="legend-item">
      <span style="color:#9b59b6;font-weight:700;font-family:monospace;font-size:11px;width:38px;display:inline-block;">LIFR</span>
      &lt;500 ft / &lt;1.5 km
    </div>
    <div class="legend-item" style="margin-top:8px;border-top:1px solid #e0e0e0;padding-top:8px;">
      <a href="docs/user-manual.html" target="_blank" rel="noopener" style="font-size:11px;color:#2980b9;text-decoration:none;">User Manual</a>
    </div>
  </div>

  <div id="da62-min" class="panel-mini panel-mini-right visible" title="DA62">&#9992;</div>
  <div id="da62-panel" class="panel minimized">
    <div class="panel-tabs">
      <button class="panel-tab active" data-tab="tab-range">Range</button>
      <button class="panel-tab" data-tab="tab-route">Route</button>
      <button class="panel-tab" data-tab="tab-wb">W&B</button>
      <span class="panel-tab-spacer"></span>
      <button id="settings-save" class="panel-io-btn" title="Save settings to file">&#x2B07;</button>
      <button id="settings-load" class="panel-io-btn" title="Load settings from file">&#x2B06;</button>
      <button class="panel-minimize panel-io-btn" data-target="da62-panel" data-mini="da62-min" title="Minimize">&minus;</button>
      <input type="file" id="settings-file" accept=".json" style="display:none">
    </div>

    <div id="tab-range" class="tab-content active">
      <div class="range-toggle-row">
        <input type="checkbox" id="range-toggle">
        <label for="range-toggle">Show range circles</label>
      </div>
      <div class="range-hint">Click map or airport to set departure</div>
      <label for="range-fuel">Fuel (US gal)</label>
      <input type="number" id="range-fuel" value="86" max="86" min="0" step="0.1">
      <label for="range-power">Power setting</label>
      <select id="range-power"></select>
      <div id="range-summary"></div>
      <button id="range-clear">Clear</button>
    </div>

    <div id="tab-route" class="tab-content">
      <button id="route-toggle" class="route-btn route-btn-start">Start Route</button>
      <div id="route-settings"></div>
      <div id="route-flight-info">
        <label for="route-dep-time">Dep UTC</label>
        <input type="text" id="route-dep-time" maxlength="5" placeholder="HH:MM" pattern="\d{2}:\d{2}">
        <label for="route-fl">FL</label>
        <input type="number" id="route-fl" value="80" min="10" max="250" step="10">
        <label class="route-wx-toggle" title="Show wind barbs along route"><input type="checkbox" id="route-wx-show">Wx</label>
        <button id="auto-route-btn" class="route-btn route-btn-auto" title="Find IFR route via autorouter">Auto Route (IFR)</button>
      </div>
      <div id="route-waypoints"></div>
      <div id="route-totals"></div>
      <div class="route-actions">
        <button id="route-undo" class="route-btn route-btn-sm" disabled>Undo Last</button>
        <button id="route-clear" class="route-btn route-btn-sm" disabled>Clear Route</button>
      </div>
    </div>

    <div id="tab-wb" class="tab-content">
      <div class="wb-row wb-row-header">
        <label>Empty</label>
        <input type="number" id="wb-empty-wt" value="1687" step="1" class="wb-input"> kg
        <input type="number" id="wb-empty-cg" value="2.374" step="0.001" class="wb-input wb-input-sm"> m
      </div>
      <div class="wb-row">
        <label>TKS fluid</label>
        <input type="number" id="wb-deice" value="" placeholder="0" step="0.1" class="wb-input"> kg
      </div>
      <div class="wb-row">
        <label>Front L/R</label>
        <input type="number" id="wb-front-l" value="90" placeholder="0" step="1" class="wb-input">
        <input type="number" id="wb-front-r" value="" placeholder="0" step="1" class="wb-input"> kg
      </div>
      <div class="wb-row">
        <label>Rear L/R</label>
        <input type="number" id="wb-row1-l" value="" placeholder="0" step="1" class="wb-input">
        <input type="number" id="wb-row1-r" value="" placeholder="0" step="1" class="wb-input"> kg
      </div>
      <div class="wb-row">
        <label>Nose RH</label>
        <input type="number" id="wb-nose-rh" value="" placeholder="0" max="30" step="0.1" class="wb-input"> <span class="wb-max">max 30 kg</span>
      </div>
      <div class="wb-row">
        <label>Nose LH</label>
        <input type="number" id="wb-nose-lh" value="" placeholder="0" max="30" step="0.1" class="wb-input"> <span class="wb-max">max 30 kg</span>
      </div>
      <div class="wb-row">
        <label>Tail A</label>
        <input type="number" id="wb-tail-a" value="" placeholder="0" max="6" step="0.1" class="wb-input"> <span class="wb-max">max 6 kg</span>
      </div>
      <div class="wb-row">
        <label>Tail B</label>
        <input type="number" id="wb-tail-b" value="" placeholder="0" max="6" step="0.1" class="wb-input"> <span class="wb-max">max 6 kg</span>
      </div>
      <div class="wb-row">
        <label>Tail C</label>
        <input type="number" id="wb-tail-c" value="" placeholder="0" max="68" step="0.1" class="wb-input"> <span class="wb-max">max 68 kg</span>
      </div>
      <div class="wb-row">
        <label>Tail D</label>
        <input type="number" id="wb-tail-d" value="" placeholder="0" max="40" step="0.1" class="wb-input"> <span class="wb-max">max 40 kg</span>
      </div>
      <div id="wb-fuel-display" class="wb-fuel-line">Fuel: 0 gal · 0 kg</div>
      <div id="wb-results"></div>
      <div id="wb-envelope"></div>
    </div>
  </div>

  <script src="js/app.js"></script>
  <script src="js/airports.js"></script>
  <script src="js/fuel-calculator.js"></script>
  <script src="js/route-planner.js"></script>
  <script src="js/weight-balance.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
